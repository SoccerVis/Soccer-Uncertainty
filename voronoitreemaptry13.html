<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>d3-voronoi-treemap usage</title>
    <meta name="description" content="d3-voronoi-treemap plugin to remake 'The Costs of Being Fat, in Actual Dollars'">
    <script src="https://d3js.org/d3.v6.min.js" charset="utf-8"></script>
    <script src="https://rawcdn.githack.com/Kcnarf/d3-weighted-voronoi/v1.0.1/build/d3-weighted-voronoi.js"></script>
    <script src="https://rawcdn.githack.com/Kcnarf/d3-voronoi-map/v2.0.1/build/d3-voronoi-map.js"></script>
    <!-- <script src="https://rawcdn.githack.com/Kcnarf/d3-voronoi-treemap/v1.1.1/build/d3-voronoi-treemap.js"></script> -->
    <script src="https://unpkg.com/textures@1.2.0/dist/textures.js"></script>
    
    <script src="/d3-voronoi-treemap-master/build/d3-voronoi-treemap.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.3/seedrandom.min.js"></script>
    <!-- <script src="/d3-voronoi-treemap-master/build/d3-voronoi-treemap.min.js"></script> -->
    <!-- <script src="/d3-voronoi-treemap-master/src/d3-voronoi-treemap.js"></script> -->
    <style>
      svg {
        background-color: rgb(250,250,250);
      }
      
      #title {
        letter-spacing: 4px;
        font-weight: 700;
        font-size: x-large;
      }
      
      text.tiny {
        font-size: 10pt;
      }
      text.light {
        fill: lightgrey
      }
      
      .world {
        stroke: lightgrey;
		    stroke-width: 4px;
      }
      
      .cell {
        stroke: white;
        stroke-width: 1px;
      }
      
      .label {
        text-anchor: middle;
        /* fill: white; */
        
      }
      
       .label>.name {
        dominant-baseline: text-after-edge;
      }
      
      .label>.value {
        dominant-baseline: text-before-edge;
      }
      
      .hoverer {
        fill: transparent;
        stroke: white;
        stroke-width:0px;
      }
      
      .hoverer:hover {
        stroke-width: 3px;
      }
      
      .legend-color {
        stroke-width: 1px;
        stroke:darkgrey;
      }
    </style>
  </head>
  <body>
    <div id="div_container">
      <div id="div_header">
      </div>

      <div id="div_map">
      </div>

      <div id="div_legends">
      </div>
    </div>
 



  </body>
    <svg></svg>
    <svg >
      <defs>
          <pattern id="img_France" width="100%" height="100%" patternContentUnits="objectBoundingBox">
              <image width="1" height="1" xlink:href="img/法国.png"/>
          </pattern>
          <pattern id="img_Brazil" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/巴西.png"/>
          </pattern>
          <pattern id="img_England" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/英格兰.png"/>
          </pattern>
          <pattern id="img_Argentina" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/阿根廷.png"/>
          </pattern>
          <pattern id="img_Netherlands" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/荷兰.png"/>
          </pattern>
          <pattern id="img_Croatia" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/克罗地亚.png"/>
          </pattern>
          <pattern id="img_Morocco" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/摩洛哥.png"/>
          </pattern>
          <pattern id="img_Portuguesa" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/葡萄牙.png"/>
          </pattern>

        <pattern id="img2_France" width="100%" height="100%" patternContentUnits="objectBoundingBox">
            <image width="1" height="1" xlink:href="img/法国国旗.png"/>
        </pattern>
        <pattern id="img2_Brazil" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/巴西国旗.png"/>
        </pattern>
        <pattern id="img2_England" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/英格兰国旗.png"/>
        </pattern>
        <pattern id="img2_Argentina" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/阿根廷国旗.png"/>
        </pattern>
        <pattern id="img2_Netherlands" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/荷兰国旗.png"/>
        </pattern>
        <pattern id="img2_Croatia" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/克罗地亚国旗.png"/>
        </pattern>
        <pattern id="img2_Morocco" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/摩洛哥国旗.png"/>
        </pattern>
        <pattern id="img2_Portuguesa" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/葡萄牙国旗.png"/>
        </pattern>
        <pattern id="img_cup" width="100%" height="100%" patternContentUnits="objectBoundingBox">
          <image width="1" height="1" xlink:href="img/cup.jpg"/>
        </pattern>
      </defs>
    </svg>
    <script>
     //console.log(Math.sqrt(9)) 
      //begin: constants
      var _2PI = 2*Math.PI;
      //end: constants
      
      //begin: layout conf.
      var svgWidth = 1100,
          svgHeight = 1100,
          margin = {top: 10, right: 10, bottom: 10, left: 10},
          height = svgHeight - margin.top - margin.bottom,
          width = svgWidth - margin.left - margin.right,
          halfWidth = width/2,
          halfHeight = height/2,
          quarterWidth = width/4,
          quarterHeight = height/4,
          titleY = 20,
          legendsMinY = height - 20,
          treemapRadius = 410,
          treemapCenter = [halfWidth, halfHeight+5];
      //end: layout conf.
      
      //begin: treemap conf.
      var _voronoiTreemap = d3.voronoiTreemap();
      var hierarchy, circlingPolygon;
      //end: treemap conf.
      
      //begin: drawing conf.
      var fontScale = d3.scaleLinear();
      //end: drawing conf.
      





      //begin: reusable d3Selection
      var svg, drawingArea, treemapContainer;
      //end: reusable d3Selection
      
      d3.json("noposition5.json").then(function(rootData) {
        initData();
        initLayout(rootData);
        //console.log(rootData)
        hierarchy = d3.hierarchy(rootData)
       .sum(function(d){ return d.value; }); // assigns the adequate weight to each node of the d3-hierarchy
        //console.log(hierarchy) //此处已经有内部形状坐标？？why？



        var leaves=hierarchy.leaves();
        //console.log(leaves)

        console.log(leaves)



        var AllMySeeds=['a','b','c','d','e','f','g','h','i','g']
        var index1=Math.trunc(Math.random()*10-1)
        var index2=Math.trunc(Math.random()*10-1)
        var index3=Math.trunc(Math.random()*10-1)
        var index4=Math.trunc(Math.random()*10-1)
        var index5=Math.trunc(Math.random()*10-1)
        //console.log(AllMySeeds[index1])
        var MySeed=AllMySeeds[index1]+AllMySeeds[index2]+AllMySeeds[index3]+AllMySeeds[index4]+AllMySeeds[index5]
        //console.log(MySeed)
        //var mySeededPrng = new Math.seedrandom("dgbib");
        // mySeededPrng = new Math.seedrandom(MySeed);
        //var ran=Math.random
        //console.log(circlingPolygon)//points所定义的轮廓坐标 

        function load(){
          var AllMySeeds=['a','b','c','d','e','f','g','h','i','g']
        var index1=Math.trunc(Math.random()*10-1)
        var index2=Math.trunc(Math.random()*10-1)
        var index3=Math.trunc(Math.random()*10-1)
        var index4=Math.trunc(Math.random()*10-1)
        var index5=Math.trunc(Math.random()*10-1)
        //console.log(AllMySeeds[index1])
        var MySeed=AllMySeeds[index1]+AllMySeeds[index2]+AllMySeeds[index3]+AllMySeeds[index4]+AllMySeeds[index5]
        //console.log(MySeed)
        //var mySeededPrng = new Math.seedrandom("dadhd");//布局1 
        //var mySeededPrng = new Math.seedrandom("acagc");//布局2
        var mySeededPrng = new Math.seedrandom("hcidi");//布局3
        //mySeededPrng = new Math.seedrandom(MySeed);
        //var ran=Math.random
        //console.log(circlingPolygon)//points所定义的轮廓坐标 
          _voronoiTreemap
          .clip(circlingPolygon)
          .prng(mySeededPrng)
          //.extent([[0, 410.00000000000006],[699.9137802864867, 120.08621971351778]]) //剪裁为矩形
        	(hierarchy);
        }



        load();



          // do {
          // load();

          //     var flag0=0
          //    if(leaves[180].parent.polygon.site.x>300&&leaves[180].parent.polygon.site.x<500&&leaves[180].parent.polygon.site.y>300&&leaves[180].parent.polygon.site.y<500
          //    &&leaves[180].parent.polygon.site.neighbours.length==7
          //    ){
          //       flag0=1

          //     }
          //     var flag1=0
          //     for(i=0;i<leaves[160].parent.polygon.site.neighbours.length;i++){
          //         if(leaves[160].parent.polygon.site.neighbours[i].x==leaves[130].parent.polygon.site.x){
          //                flag1=1;
          //       }
          //     }
          //     var flag2=0
          //     for(i=0;i<leaves[130].parent.polygon.site.neighbours.length;i++){
          //         if(leaves[130].parent.polygon.site.neighbours[i].x==leaves[110].parent.polygon.site.x){
          //                flag2=1;
          //       }
          //     }
          //      var flag3=0
          //     for(i=0;i<leaves[110].parent.polygon.site.neighbours.length;i++){
          //         if(leaves[110].parent.polygon.site.neighbours[i].x==leaves[90].parent.polygon.site.x){
          //                flag3=1;
          //       }
          //     }

          //     var flag4=0
          //     for(i=0;i<leaves[90].parent.polygon.site.neighbours.length;i++){
          //         if(leaves[90].parent.polygon.site.neighbours[i].x==leaves[60].parent.polygon.site.x){
          //                flag4=1;
          //       }
          //     }
          //     var flag5=0
          //     for(i=0;i<leaves[60].parent.polygon.site.neighbours.length;i++){
          //         if(leaves[60].parent.polygon.site.neighbours[i].x==leaves[30].parent.polygon.site.x){
          //                flag5=1;
          //       }
          //     }
          //     console.log(flag0,flag1,flag2,flag3,flag4,flag5)
          // } while (flag0*flag1*flag2*flag3*flag4*flag5==0);
      



        drawTreemap(hierarchy);


        

        
      });
      
      function initData(rootData) {
        circlingPolygon = computeCirclingPolygon(treemapRadius);
        fontScale.domain([1, 80]).range([0.1, 10])
        .clamp(true);
        newpo=computeCirclingPolygon(430);
        console.log(newpo)
      }
      
      function computeCirclingPolygon(radius) {
        var points = 500,    //可调节轮廓形状
            increment = _2PI/points,
            circlingPolygon = [];
        
        for (var a=0, i=0; i<points; i++, a+=increment) {
          circlingPolygon.push(
            [radius + radius*Math.cos(a), radius + radius*Math.sin(a)]
          )
        }
        
      	return circlingPolygon;
      };
      
      
      function initLayout(rootData) {
        svg_map = d3.select("#div_map").append("svg")
        .attr("width",svgWidth)
        .attr("height", svgHeight)
        // svg = d3.select("svg")
        //   .attr("width", svgWidth)
        //   .attr("height", svgHeight);


        
        drawingArea = svg_map.append("g")
        	.classed("drawingArea", true)
        	.attr("transform", "translate("+[margin.left,margin.top]+")");

          
        
        treemapContainer = drawingArea.append("g")
        	.classed("treemap-container", true)
        	.attr("transform", "translate("+treemapCenter+")");
        
        treemapContainer.append("path")
        	.classed("world", true)
        	.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+")")
        	.attr("d", "M"+circlingPolygon.join(",")+"Z");







        treemapContainer.append("rect")
        .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-10)")
        .style("transform-box","fill-box")
          .style("transform-origin","center")
        	.attr("y", 13-60)
          .attr("x", 323+40)
        	.attr("width", 40)
        	.attr("height", 40)
        	.style("fill", function(d){ return ("url(#img_cup)" )});


        // treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(35)")
        //   .attr("id","rect1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 660).attr("y", 66-87100/636305*300).attr("width", 20).attr("height", 87100/636305*300).style("fill", "rgb(0,139,69)");

        // console.log(d3.select("#rect1"))
        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(35)")
        //   .attr("id","text1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 660).attr("y", 66-87100/636305*300).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("13.69%")
        // //.style('font-size',"22")
        // //.text("①")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(35)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 660).attr("y",  66-87100/636305*300-12).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(35)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 680).attr("y", 66+15).style("fill", "grey")
        // .style('font-size',"22")
        // .text("⑧")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(35)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 680).attr("y", 65).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(35)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 41-14)
        //   .attr("x", 627.6)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_Portuguesa)" )});	





        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(90)")
        //   .attr("id","rect1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 860-10).attr("y", 425- 105850/636305*300/2).attr("width", 20).attr("height", 105850/636305*300).style("fill", "rgb(50,107,199)");

        // console.log(d3.select("#rect2"))
        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(90)")
        //   .attr("id","text1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 860+10).attr("y", 425+5).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("16.64%")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(90)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 874).attr("y", 430).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(90)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 860-20).attr("y", 425+25+15).style("fill", "grey")
        // .style('font-size',"22")
        // .text("②")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(90)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 845).attr("y", 453+15).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(85)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 386.8)
        //   .attr("x", 857.8-25)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_France)" )});


        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(158)")
        //   .attr("id","rect3")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 552+20).attr("y", 842-40).attr("width", 20).attr("height", 114700/636305*300).style("fill", "rgb(245,209,0)");

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(158)")
        //   .attr("id","text1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 552+12).attr("y", 842+33).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("18.03%")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(158)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 564-5).attr("y", 875+10).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(158)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 538).attr("y", 842).style("fill", "grey")
        // .style('font-size',"22")
        // .text("⑦")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(158)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 538-10).attr("y", 842+15).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(153)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 842-52)
        //   .attr("x", 552+40)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_Brazil)" )});

        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-13)")
        //   .attr("id","rect4")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 323-19).attr("y", 13-50).attr("width", 20).attr("height", 71020/636305*300).style("fill", "rgb(159,205,238)");

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-13)")
        //   .attr("class","agenting")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 323-42).attr("y", 13-50-5).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("11.16%")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-13)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 323-42-10-5).attr("y", 13-50-5-15).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-13)")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 323+10).attr("y", -15).style("fill", "grey")
        // .style('font-size',"22")
        // .text("①")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-13)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 323).attr("y", -35).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-17)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 13-50+22)
        //   .attr("x", 323-50)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_Argentina)" )});

        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-60)")
        //   .attr("id","rect5")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 49-33).attr("y", 181).attr("width", 20).attr("height", 60525/636305*300).style("fill", "rgb(242,107,23)");

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-60)")
        //   .attr("id","text1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 9-33+7).attr("y", 181+3).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("9.51%")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-60)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", -25-15-2).attr("y", 184-10).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-60)")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-60)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 35).attr("y", 180).style("fill", "grey")
        // .style('font-size',"22")
        // .text("⑤")
        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-60)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 14).attr("y", 160).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-64)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 181+35)
        //   .attr("x", 5)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_Netherlands)" )});

        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-105)")
        //   .attr("id","rect6")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", -22).attr("y", 500+10).attr("width", 20).attr("height", 40000/636305*300).style("fill", "rgb(236,28,35)");

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-105)")
        //   .attr("id","text1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", -65).attr("y", 500+30).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("6.29%")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-105)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", -65-30).attr("y", 530).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-109)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", -33).attr("y", 500).style("fill", "grey")
        // .style('font-size',"22")
        // .text("③")

        

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-109)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", -62).attr("y", 494).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-109)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 500+40)
        //   .attr("x", -13 )
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_Croatia)" )});

        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
        //   .attr("id","rect6")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 159).attr("y", 760).attr("width", 20).attr("height", 29110/636305*300).style("fill", "rgb(134,39,33)");

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
        //   .attr("id","text1")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 159-30).attr("y", 760+25+15).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("4.57%")


        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 129-15-5).attr("y", 800+20-7).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")


        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x",130).attr("y", 760).style("fill", "grey")
        // .style('font-size',"22")
        // .text("④")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x",100).attr("y", 763).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-146)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 760+15)
        //   .attr("x", 159+25)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_Morocco)" )});

        //   treemapContainer.append("rect")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(0)")
        //   .attr("id","rect8")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 845).attr("y", 720-128000/636305*300).attr("width", 20).attr("height", 128000/636305*300).style("fill", "rgb(106,90,205)");

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(0)")
        //   .attr("id","text8")
        //   //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // //.attr("x", 660+2).attr("y", 66-40).style("fill", "grey")
        // .attr("x", 835).attr("y", 655).style("fill", "grey")
        // //.attr("x", 660+Math.cos(35)*87100/636305*300).attr("y",66-87100/636305*300+Math.sin(35)*87100/636305*300).style("fill", "grey")
        // .text("20.12% ")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(0)")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 835-5).attr("y", 655-15).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Market Value")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(0)")
        //   .attr("id","text1")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 875).attr("y", 715).style("fill", "grey")
        // .style('font-size',"22")
        // .text("⑥")

        // treemapContainer.append("text")
        //   .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
        //   .attr("class","agentingtext")
        //   .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // .attr("x", 869).attr("y", 695).style("fill", "grey")
        // .style('font-size',"12")
        // .text("Ranking")

        // treemapContainer.append("rect")
        // .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(0)")
        // .style("transform-box","fill-box")
        //   .style("transform-origin","center")
        // 	.attr("y", 700)
        //   .attr("x", 810)
        // 	.attr("width", 20)
        // 	.attr("height", 20)
        // 	.style("fill", function(d){ return ("url(#img2_England)" )});




        drawTitle();
        drawFooter();
        drawLegends(rootData);
        

      }
      
      function drawTitle() {
        drawingArea.append("text")
        	.attr("id", "title")
        	.attr("transform", "translate("+[halfWidth, titleY]+")")
        	.attr("text-anchor", "middle")
          .text("世界杯8强球队")
      }
      
      function drawFooter() {
        drawingArea.append("text")
        	.classed("tiny light", true)
        	.attr("transform", "translate("+[0, height]+")")
        	.attr("text-anchor", "start")
        	//.text("Remake of HowMuch.net's article 'The Global Economy by GDP'")
        drawingArea.append("text")
        	.classed("tiny light", true)
        	.attr("transform", "translate("+[halfWidth, height]+")")
        	.attr("text-anchor", "middle")
        	//.text("by @_Kcnarf")
        drawingArea.append("text")
        	.classed("tiny light", true)
        	.attr("transform", "translate("+[width, height]+")")
        	.attr("text-anchor", "end")
        	//.text("bl.ocks.org/Kcnarf/fa95aa7b076f537c00aed614c29bb568")
      }
      

      // //var d1 = document.getElementById("d1");//获取div元素
      // var im = document.createElement("img");//创建图片
      // im.src = "img/1.png";
      // //图片设置成和div一样大小
      // im.style.width = d1.style.width;
      // im.style.height = d1.style.height ;
      // d1.appendChild(im);	//图片挂载到div上

 function ComputePoint(xx,yy,r){

 }



      function drawLegends(rootData) {



        var legendHeight = 13,
            interLegend = 4,
            colorWidth = legendHeight*6,
            continents = rootData.children.reverse();
        
        var legendContainer = drawingArea.append("g")
        	.classed("legend", true)
        	.attr("transform", "translate("+[0, legendsMinY]+")");
        
        var legends = legendContainer.selectAll(".legend")
        	.data(continents)
        	.enter();
        
        var legend = legends.append("g")
        	.classed("legend", true)
        	.attr("transform", function(d,i){
            return "translate("+[0, -i*(legendHeight+interLegend)]+")";
          })
          legend.append("rect")
        	//.classed("legend-color", true)
        	.attr("y", -legendHeight)
          
        	.attr("width", colorWidth/5)
        	.attr("height", legendHeight)
        	.style("fill", function(d){ return ("url(#img_"+d.name2+")" )});	


        legend.append("rect")
        	.classed("legend-color", true)
        	.attr("y", -legendHeight)
          .attr("x", colorWidth/5+3)
        	.attr("width", colorWidth/2)
        	.attr("height", legendHeight)
        	.style("fill", function(d){ return d.color; });

        legend.append("text")
        	.classed("tiny", true)
        	.attr("transform", "translate("+[colorWidth-10, -2]+")")
          .attr("id",function(d,i) {return "text_" + i;})
        	.text(function(d){ return d.name2; });

          //console.log(d3.select("#text_7"))


          legend.append("rect")
        	
        	.attr("y", -legendHeight)
          .attr("x", function(d){ return (colorWidth+d.len-3) })
        	.attr("width", colorWidth/5)
        	.attr("height", legendHeight)
        	.style("fill", function(d){ return ("url(#img2_"+d.name2+")" )});	
        



        
        legendContainer.append("text")
        	.attr("transform", "translate("+[15, -continents.length*(legendHeight+interLegend)-5]+")")
          .text("Teams");
      }
      
      function drawTreemap(hierarchy) {
        //console.log(hierarchy)
        var leaves=hierarchy.leaves();
        //console.log(leaves)  //polygon中有各个顶点的坐标


        var cells = treemapContainer.append("g")
        	.classed('cells', true)
        	.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+")")
	        .selectAll(".cell")
        	.data(leaves)
        	.enter()
        		.append("path")
        			.classed("cell", true)
        			.attr("d", function(d){ return "M"+d.polygon.join(",")+"z"; })
              //.attr("filter","url(#f1)")
        			.style("fill", function(d){
                return d.parent.data.color;
          		})
              // .call(t)
              // .style("fill", t.url())
              .attr("id",function(d,i) {return "cell_" + i;})
               ;
              var AllCell = d3.selectAll('.cell')

              var cells2 = treemapContainer.append("g")
        	.classed('cells2', true)
        	.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+")")
	        .selectAll(".cell2")
        	.data(leaves)
        	.enter()
        		.append("path")
        			.classed("cell2", true)
        			.attr("d", function(d){ return "M"+d.polygon.join(",")+"z"; })
              //.attr("filter","url(#f1)")
        			.style("fill", function(d){
                return d.parent.data.color;
          		})
              // .call(t)
              // .style("fill", t.url())
              .attr("id",function(d,i) {return "cell2_" + i;})
               ;

              // console.log(AllCell._groups[0]);
             
              // console.log(leaves[180].parent.polygon.site);//England
              // console.log(leaves[160].parent.polygon.site);  //Brazil
              // console.log(leaves[130].parent.polygon.site);  //France
              // console.log(leaves[110].parent.polygon.site);  //putaoya
              // console.log(leaves[90].parent.polygon.site);  //agenting
              // console.log(leaves[60].parent.polygon.site); //helan
              // console.log(leaves[30].parent.polygon.site);  //keluodiya
    
              // console.log(leaves[0].parent.polygon.site); //moluoge

              console.log(leaves[180].parent);//England
              console.log(leaves[160].parent);  //Brazil
              console.log(leaves[130].parent);  //France
              console.log(leaves[110].parent);  //putaoya
              console.log(leaves[90].parent);  //agenting
              console.log(leaves[60].parent); //helan
              console.log(leaves[30].parent);  //keluodiya
    
              console.log(leaves[0].parent); //moluoge



              for(var k=0;k<AllCell._groups[0].length;k++)
              {
              d3.select('svg').append('filter').attr('id','f'+k)
              d3.select("#f"+k)
                .append('feGaussianBlur').attr('in','SourceGraphic').attr('stdDeviation',leaves[k].data.var*3)
              }
                
                

              
              
              var myCons=3

                for(var k=0;k<AllCell._groups[0].length;k++)
              {
              let cell_brightness = document.querySelector("#cell_"+k);

              //if(leaves[k].parent.data.name2=="France"&&)




              
			        var color = d3.color(leaves[k].parent.data.color);

              if(leaves[k].data.mean!=null){
              //var color = color.brighter(1+(1-leaves[k].data.score1/myCons));
              var color = color.brighter(leaves[k].data.mean/myCons-2);
			        // cell_brightness.style.fill =
			        // `rgb(${color.r},${color.g},${color.b})`;color
              var color2=`rgb(${color.r},${color.g},${color.b})`

              }


              
              //d3.select("#cell_"+k).attr("background-color",color2);
              d3.select("#cell_"+k).style("fill",color2);
              d3.select("#cell_"+k).attr("filter","url(#f"+k+")");
              
              }

              for(var k=0;k<AllCell._groups[0].length;k++){
              //   var t = textures.lines()
              // .thinner((1-leaves[k].parent.data.delta_r/10)+1.2)
              // //.orientation("diagonal")
              // //.size(18)//阴影整体缩放
              // .strokeWidth(1)//阴影线条粗细
              // .stroke("grey")
              // //.background("none");


              var t = textures.paths()
              .d(s =>
              `M 0,${s * 3 / 4} 

                `
              )
              .thinner((1-leaves[k].parent.data.delta_r/10)+1.2)
              //.size(100)
              .strokeWidth(1)//阴影线条粗细
              .stroke("grey")

if (leaves[k].parent.data.name2=="France"||leaves[k].parent.data.name2=="Portuguesa"){
  var t = textures.paths()
              .d(s =>
              `M 0,${s * 3 / 4} 
                l ${s / 2},${-s / 2} 
                l ${-s / 4},0
                M ${s / 2},${s / 4}
                l 0,${s / 4}
                `
              )
              .thinner((1-leaves[k].parent.data.delta_r/10)+1.2)
              .strokeWidth(1)//阴影线条粗细
              .stroke("#53565c")
}


              if(leaves[k].parent.data.delta_r>=0){
                svg_map.call(t);
                
                d3.select("#cell2_"+k).style("fill",t.url());
                
              }

              var t3 = textures.paths()

  // .d(s =>
  // `M ${s / 4},${s / 4} 
  //   l ${s / 2},${s / 2} 
    
  //   M ${s *3/ 4},${s *3/ 4}
  //   l 0,${-s / 4}
  //   M ${s *3/ 4},${s *3 / 4}
  //   l ${-s / 4},0
  //   `
  //   )

  .d(s =>
  `M ${s / 4},${s / 4} 
     `
    )
              
              .thinner((1+leaves[k].parent.data.delta_r/10)+1.2)
              //.orientation("diagonal")
              //.size(20)
              .strokeWidth(1)
              //.thicker(2)
              //.background(color2)
              .stroke("grey");
              
              if (leaves[k].parent.data.name2=="England"){
  var t3 = textures.paths()
  .d(
    s =>
  `M ${s / 4},${s / 4} 
    l ${s / 2},${s / 2} 
    
    M ${s *3/ 4},${s *3/ 4}
    l 0,${-s / 4}
    M ${s *3/ 4},${s *3 / 4}
    l ${-s / 4},0
    `
    )
              .thinner((1-leaves[k].parent.data.delta_r/10)+1.2)
              .strokeWidth(1)//阴影线条粗细
              .stroke("#53565c")
}


              if(leaves[k].parent.data.delta_r<0){
                svg_map.call(t3);
              //cell_brightness.style.fill= t3.url();
              d3.select("#cell2_"+k).style("fill",t3.url());
              }
              }
              
 


        var labels = treemapContainer.append("g")
        	.classed('labels', true)
        	.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+")")
	        .selectAll(".label")
        	.data(leaves)
        	.enter()
        		.append("g")
        			.classed("label", true)
        			.attr("transform", function(d){
          			return "translate("+[d.polygon.site.x, d.polygon.site.y]+")";
              })
              .style("fill", function(d){ return d.parent.data.font_color})
              //.style("fill", "white")
        			.style("font-size", function(d){ return fontScale(d.data.value/2); });
        
        labels.append("text")
        	.classed("name", true)
          
        	.html(function(d){
          	return (d.data.value<1)? d.data.code : d.data.name2;
        	});
        // labels.append("text")
        // 	.classed("value", true)
        // 	.text(function(d){ return d.data.value+"%"; });
        
        var hoverers = treemapContainer.append("g")
        	.classed('hoverers', true)
        	.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+")")
	        .selectAll(".hoverer")
        	.data(leaves)
        	.enter()
        		.append("path")
        			.classed("hoverer", true)
              .attr("id",function(d,i) {return "hov_" + i;})
        			.attr("d", function(d){ return "M"+d.polygon.join(",")+"z"; });
        
        hoverers.append("title")
          .text(function(d) { return d.data.name + "\n" + "身价："+d.value+"万欧元"+ "\n" + "评分方差："+d.data.var+ "\n" + "评分均值："+d.data.mean+ "\n" + "名次差："+d.parent.data.delta_r; });

          treemapContainer.append("path")
          .attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") ")
          .attr("d","M410 410 L 720 710 L 800 710")
          .attr('fill','none')
          .attr("stroke","grey")


var data =[
  [35,33,34,34,32,33,29,28,28,24,24,22,23,22,11], //Morocco 
  [11,11,14,14,18,17,18,15,15,15,16,15,15,12,7],//Croatia
  [14,14,16,16,12,11,11,10,10,10,10,8,8,8,6],//Netherlands
  [7,7,8,8,6,6,6,5,5,4,4,3,3,3,2],//Argentina
  [5,5,5,5,8,7,8,8,8,8,8,9,9,9,9],//protuguesa
  [2,2,2,2,3,4,3,3,3,3,3,4,4,4,3],//France
  [3,3,3,3,2,2,2,2,2,2,1,1,1,1,1], //brazil
  
  [4,4,4,4,4,3,5,4,4,5,5,5,5,5,5],//England
  
  
  
  
 
]
  
var parentcolor=['rgb(134,39,33)','rgb(236,28,35)','rgb(242,107,23)','rgb(159,205,238)','rgb(0,139,69)',"rgb(50,107,199)",'rgb(245,209,0)','rgb(106,90,205)']
function dataNormalization(data){
var m = 8;
var  n = 15;
let arr = []; // create an empty array of length n
for (var k = 0; k < m; k++) {
  arr[k] = []; // make each element an array
}
console.log(arr); //  Output: [ [ <5 empty items> ], [ <5 empty items> ], [ <5 empty items> ], [ <5 empty items> ] ]
  for(i=0;i<8;i++){
    var data_sorted = data[i].sort(d3.ascending);
    for(j=0;j<15;j++){
      arr[i][j]=(data_sorted[j]-data_sorted[0])/(data_sorted[14]-data_sorted[0])
    }
    
  }
return(arr)
}
newdata=dataNormalization(data)
console.log(newdata)

var positionArr=[[[-480-20,-530-20 ],-600,-142,"④","4.57","Morocco"],
[[-480+360,-530+360 ],-520,-104,"③","6.29","Croatia"],
[[-480+600,-530+600],-170,-60,"⑤","9.51","Netherlands"],
[[380-340,330-340],300,-13,"①","11.16","Argentina"],
[[380-760,330-760],600,37,"⑧","13.69","Portuguesa"],
[[380-1245,330-1245],420,90,"②","16.64","France"],
[[380-1400,330-1400],-220,158,"⑦","18.03","Brazil"],
[[710+0,710-50],850,0,"⑥","20.12","England"]]
for(i=0;i<8;i++){
  var data_sorted = newdata[i].sort(d3.ascending)
console.log(data_sorted)
var q1 = d3.quantile(data_sorted, .25)
var median = d3.quantile(data_sorted, .5)
var q3 = d3.quantile(data_sorted, .75)
var interQuantileRange = q3 - q1
console.log(interQuantileRange)
var min = q1 - 1.5 * interQuantileRange
var max = q1 + 1.5 * interQuantileRange

//var min =data_sorted[0]
//var max =data_sorted[14]

// Show the Y scale
var y = d3.scaleLinear()
  .domain([0,1])
  .range(positionArr[i][0]);
  //treemapContainer.call(d3.axisLeft(y))
//svg.call(d3.axisLeft(y))
console.log(y(min))

// a few features for the box
var center = positionArr[i][1]
var width = 20

// Show the main vertical line
treemapContainer
.append("line")
.attr("class","boxplot_" + i)
  .attr("x1", center)
  .attr("x2", center)
  .attr("y1", y(min) )
  .attr("y2", y(max) )
  .attr("stroke", "grey")


// Show the box
treemapContainer
.append("rect")
.attr("class","boxplot_" + i)
  .attr("x", center - width/2)
  .attr("y", y(q3) )
  .attr("height", Math.abs(y(q1)-y(q3)) )
  .attr("width", width )
  .attr("stroke", "grey")
  .style("fill", parentcolor[i])

// show median, min and max horizontal lines
treemapContainer
.selectAll("toto")

.data([min, median, max])
.enter()
.append("line")
  .attr("x1", center-width/2)
  .attr("x2", center+width/2)
  .attr("y1", function(d){ return(y(d))} )
  .attr("y2", function(d){ return(y(d))} )
  .attr("stroke", "black")
.attr("class","boxplot_" + i)

 
//   treemapContainer
// .append("line")
//   .attr("x1", center+50)
//   .attr("x2", center-50)
//   .attr("y1", y(min))
//   .attr("y2", y(max))
//   .attr("stroke", "black")

//   treemapContainer
// .append("line")
//   .attr("x1", center+50)
//   .attr("x2", center+50-5)
//   .attr("y1", y(min))
//   .attr("y2", y(min)-10)
//   .attr("stroke", "black")

//   treemapContainer
// .append("line")
//   .attr("x1", center+50-10)
//   .attr("x2", center+50)
//   .attr("y1", y(min)+5)
//   .attr("y2", y(min))
//   .attr("stroke", "black")




        treemapContainer.append("text")
         
          .attr("class","boxplot_" + i)

        .attr("x", center+18).attr("y", y(min)-40).style("fill", "grey")
        .text(positionArr[i][4]+"%")


        treemapContainer.append("text")
          //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
          .attr("class","boxplot_" + i)
          //.attr("class","agentingtext")
          //.style("transform-box","fill-box")
          //.style("transform-origin","center")
        .attr("x", center+14).attr("y", y(min)-60).style("fill", "grey")
        .style('font-size',"12")
        .text("Market Value")


        treemapContainer.append("text")
          //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
          .attr("class","boxplot_" + i)
          //.style("transform-box","fill-box")
          //.style("transform-origin","center")
        .attr("x",center+20).attr("y", y(min)).style("fill", "grey")
        .style('font-size',"22")
        .text(positionArr[i][3])

        treemapContainer.append("text")
          //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-142)")
          .attr("class","boxplot_" + i)
          // .style("transform-box","fill-box")
          // .style("transform-origin","center")
        .attr("x",center+17).attr("y", y(min)-20).style("fill", "grey")
        .style('font-size',"12")
        .text("Ranking")

        treemapContainer.append("rect")
        //.attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate(-146)")
        //.style("transform-box","fill-box")
          //.style("transform-origin","center")
          .attr("class","boxplot_" + i)
        	.attr("x", center-43)
          .attr("y", y(min)-15)
        	.attr("width", 20)
        	.attr("height", 20)
        	.style("fill", function(d){ return ("url(#img2_"+positionArr[i][5] +")")});

        d3.selectAll(".boxplot_"+i).attr("transform", "translate("+[-treemapRadius,-treemapRadius]+") rotate("+positionArr[i][2]+")")

}



  

// // Compute summary statistics used for the box:
// var data_sorted = data[1].sort(d3.ascending)
// var q1 = d3.quantile(data_sorted, .25)
// var median = d3.quantile(data_sorted, .5)
// var q3 = d3.quantile(data_sorted, .75)
// var interQuantileRange = q3 - q1
// var min = q1 - 1.5 * interQuantileRange
// var max = q1 + 1.5 * interQuantileRange

// // Show the Y scale
// var y = d3.scaleLinear()
//   .domain([0,70])
//   .range([400, 100]);
// //svg.call(d3.axisLeft(y))

// // a few features for the box
// var center = -200
// var width = 100

// // Show the main vertical line
// treemapContainer
// .append("line")
//   .attr("x1", center)
//   .attr("x2", center)
//   .attr("y1", y(min) )
//   .attr("y2", y(max) )
//   .attr("stroke", "grey")


// // Show the box
// treemapContainer
// .append("rect")
//   .attr("x", center - width/2)
//   .attr("y", y(q3) )
//   .attr("height", (y(q1)-y(q3)) )
//   .attr("width", width )
//   .attr("stroke", "grey")
//   .style("fill", "none")

// // show median, min and max horizontal lines
// treemapContainer
// .selectAll("toto")
// .data([min, median, max])
// .enter()
// .append("line")
//   .attr("x1", center-width/2)
//   .attr("x2", center+width/2)
//   .attr("y1", function(d){ return(y(d))} )
//   .attr("y2", function(d){ return(y(d))} )
//   .attr("stroke", "grey")

//   treemapContainer
// .append("line")
//   .attr("x1", center-50)
//   .attr("x2", center+50)
//   .attr("y1", y(min))
//   .attr("y2", y(max))
//   .attr("stroke", "black")

//   treemapContainer
// .append("line")
//   .attr("x1", center+50)
//   .attr("x2", center+50)
//   .attr("y1", y(max))
//   .attr("y2", y(max)+10)
//   .attr("stroke", "black")

//   treemapContainer
// .append("line")
//   .attr("x1", center+50-10)
//   .attr("x2", center+50)
//   .attr("y1", y(max))
//   .attr("y2", y(max))
//   .attr("stroke", "black")

      }
    </script>
  
</html>